<!DOCTYPE html>
<html>
<head>
    <title>Singing Hollow Documentation</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: black;
            overflow: hidden;
        }
        .video-container {
            position: absolute;
            opacity: 0.8;
            transition: opacity 1s ease-in-out;
        }
        video {
            opacity: 0.8;
        }
        .bottom-link {
            position: fixed;
            bottom: 10px;
            color: white;
            text-decoration: none;
            font-family: sans-serif;
            font-size: 12px;
            z-index: 101;
        }
        #reload-link {
            left: 10px;
        }
        .home-link {
            right: 10px;
        }
        #play-sound-button {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            padding: 20px;
            cursor: pointer;
            z-index: 102; /* Higher z-index to be above notation */
        }

        @media (orientation: portrait) {
            body.portrait {
                transform: rotate(90deg);
                transform-origin: center center;
                width: 100vh;
                height: 100vw;
                overflow-x: hidden;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) rotate(90deg) ;
            }
        }

        /* New Bell Notation Styles */
        #bell-notation-container {
            position: fixed;
            left: 30%; /* Start 30% from the left */
            top: 0;
            width: 30%; /* Finish roughly 60% from the left (30% + 30%) */
            height: 100vh;
            background-color: rgba(0,0,0,0.7); /* Semi-transparent background */
            color: white;
            overflow: hidden;
            padding: 20px 0; /* Vertical padding only, horizontal handled by width */
            box-sizing: border-box;
            z-index: 100; /* Ensure it's above videos but below play button */
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* Align content to the bottom */
            text-align: center; /* Center the numbers horizontally within their container */
        }
        .bell-line {
            font-family: monospace;
            font-size: 2.5em; /* Adjusted for 10 lines and readability */
            white-space: pre; /* Preserve spaces */
            line-height: 1.2;
            height: 1.2em; /* Explicit height to maintain consistent line spacing */
        }
        .bell-digit {
            opacity: 0.4;
            transition: opacity 0.1s ease-in-out; /* Smooth transition for active state */
            display: inline-block; /* Allows individual numbers to be styled */
            width: 1em; /* Give each digit a consistent width */
        }
        .bell-digit.active {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="bell-notation-container">
        <div id="bell-notation-display"></div>
    </div>
    <div id="video-players"></div>
    <a href="index.html" class="home-link bottom-link">HOME</a>
    <a href="#" id="reload-link" class="bottom-link">RELOAD</a>
    <button id="play-sound-button">Play sound</button>

    <script>
        const videoFiles = [
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230427_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230426_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230425_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230424_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230423_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230422_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230421_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230420_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230419_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230418_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230417_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230416_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230415_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230414_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230413_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230412_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230411_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230410_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230409_crf28.mp4",
            "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/123_PANA/P1230408_crf28.mp4"
        ];
        const audioFile = "https://media.githubusercontent.com/media/sebastianadams-music/singing_hollow/main/SEB_BELLS_PIECE_JULY25/audio/output.m4a";
        const maxVideos = 4;
        const videoPlayersContainer = document.getElementById('video-players');
        const playSoundButton = document.getElementById('play-sound-button');
        const reloadLink = document.getElementById('reload-link');
        let videoPlayers = [];
        let audio;
        let isInitialLoad = true;

        // Bell Notation Variables
        const plainHunt6 = [
            "123456", "214365", "241635", "426153", "462513", "645231",
            "654321", "563412", "536142", "351624", "315246", "132564"
        ];
        const fibonacciSequence = [1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987];
        let fibonacciIndex = 0;
        const baseBellSpeed = 1000; // ms per digit for fibonacci 1 (changed from 100 to 1000)
        const maxBellDisplayLines = 10;
        let currentLineIndex = 0; // Index in plainHunt6
        let currentDigitIndex = 0; // Index within the current line (0-5)
        let leadCount = 0;
        let bellAnimationTimeout;
        let currentActiveDigitElement = null; // Track the currently active digit element

        const bellNotationContainer = document.getElementById('bell-notation-container');
        const bellNotationDisplay = document.getElementById('bell-notation-display');


        function getRandomVideo() {
            return videoFiles[Math.floor(Math.random() * videoFiles.length)];
        }

        function createVideoPlayer() {
            const videoContainer = document.createElement('div');
            videoContainer.className = 'video-container';

            const video = document.createElement('video');
            video.src = getRandomVideo();
            video.autoplay = false;
            video.muted = false;
            video.width = Math.max(window.innerWidth, window.innerHeight) / 4;

            let containerWidth = window.innerWidth;
            let containerHeight = window.innerHeight;

            if (document.body.classList.contains('portrait')) {
                containerWidth = window.innerHeight;
                containerHeight = window.innerWidth;
            }

            videoContainer.style.left = Math.random() * (containerWidth - video.width) + 'px';
            videoContainer.style.top = Math.random() * (containerHeight - (video.width * 9 / 16)) + 'px';

            video.onended = () => handleVideoEnd(videoContainer, video);
            
            video.onplay = () => {
                if (!isInitialLoad) {
                    videoContainer.style.opacity = 0.8;
                }
                const fadeOutTimeout = (video.duration - 1) * 1000;
                if (fadeOutTimeout > 0) {
                    setTimeout(() => {
                        videoContainer.style.opacity = 0;
                    }, fadeOutTimeout);
                }
            };

            videoContainer.appendChild(video);
            videoPlayersContainer.appendChild(videoContainer);
            videoPlayers.push({ container: videoContainer, video: video });
        }

        function handleVideoEnd(container, video) {
            container.style.opacity = 0;
            if (Math.random() < 0.5) {
                setTimeout(() => {
                    video.src = getRandomVideo();
                    video.play();
                }, 1000);
            } else {
                container.style.display = 'none';
                setTimeout(() => {
                    video.src = getRandomVideo();
                    container.style.display = 'block';
                    video.play();
                }, Math.random() * 75000);
            }
        }

        function setupAudio() {
            audio = new Audio(audioFile);
            audio.loop = true;
            audio.volume = 0.5;
            
            audio.addEventListener('canplaythrough', () => {
                const randomStartTime = Math.random() * audio.duration;
                audio.currentTime = randomStartTime;
            });
        }

        function initBellNotation() {
            // Fill the display buffer with initial (inactive) lines
            for (let i = 0; i < maxBellDisplayLines - 1; i++) {
                const lineDiv = document.createElement('div');
                lineDiv.classList.add('bell-line');
                const lineContent = plainHunt6[i % plainHunt6.length];
                for (const digit of lineContent) {
                    const digitSpan = document.createElement('span');
                    digitSpan.classList.add('bell-digit');
                    digitSpan.textContent = digit;
                    lineDiv.appendChild(digitSpan);
                }
                bellNotationDisplay.appendChild(lineDiv);
            }
            currentLineIndex = (maxBellDisplayLines - 1) % plainHunt6.length; // Adjust starting index
        }

        function animateBellNotation() {
            // 1. Deactivate the previously active digit
            if (currentActiveDigitElement) {
                currentActiveDigitElement.classList.remove('active');
            }

            // 2. Prepare for next digit/line
            let lineDivToUpdate;
            let digitIndexToActivate = currentDigitIndex;

            if (currentDigitIndex >= plainHunt6[currentLineIndex].length) { // A full line has completed, move to next line
                currentDigitIndex = 0; // Reset digit index for the new line
                currentLineIndex++;

                if (currentLineIndex >= plainHunt6.length) { // A full lead has completed
                    currentLineIndex = 0;
                    leadCount++;
                    fibonacciIndex = (fibonacciIndex + 1) % fibonacciSequence.length; // Cycle through Fibonacci numbers
                }

                // Handle scrolling: remove oldest line, add new one
                if (bellNotationDisplay.children.length >= maxBellDisplayLines) {
                    bellNotationDisplay.removeChild(bellNotationDisplay.children[0]);
                }

                const newLine = document.createElement('div');
                newLine.classList.add('bell-line');
                const lineContent = plainHunt6[currentLineIndex];
                for (const digit of lineContent) {
                    const digitSpan = document.createElement('span');
                    digitSpan.classList.add('bell-digit');
                    digitSpan.textContent = digit;
                    newLine.appendChild(digitSpan);
                }
                bellNotationDisplay.appendChild(newLine);
                lineDivToUpdate = newLine; // New line is the target
                digitIndexToActivate = 0; // First digit of the new line
            } else {
                lineDivToUpdate = bellNotationDisplay.children[bellNotationDisplay.children.length - 1]; // Still on the last line
            }

            // 3. Activate the current digit
            const digitSpanToActivate = lineDivToUpdate.children[digitIndexToActivate];
            if (digitSpanToActivate) {
                digitSpanToActivate.classList.add('active');
                currentActiveDigitElement = digitSpanToActivate; // Store for next deactivation
            }
            
            // 4. Increment currentDigitIndex for the *next* call
            currentDigitIndex++;

            // 5. Schedule next update
            const delay = fibonacciSequence[fibonacciIndex] * baseBellSpeed;
            bellAnimationTimeout = setTimeout(animateBellNotation, delay);
        }


        function startPlayback() {
            // Play all videos
            videoPlayers.forEach(player => {
                player.video.play();
            });

            // Play audio
            if (audio) {
                audio.play();
            }
            
            isInitialLoad = false;

            // Hide the button
            playSoundButton.style.display = 'none';

            // Start bell notation animation
            animateBellNotation();
        }

        function checkOrientation() {
            if (window.matchMedia("(orientation: portrait)").matches) {
                document.body.classList.add('portrait');
            } else {
                document.body.classList.remove('portrait');
            }
        }

        // Initial setup
        for (let i = 0; i < maxVideos; i++) {
            createVideoPlayer();
        }
        setupAudio();
        checkOrientation();
        initBellNotation(); // Initialize bell notation display

        playSoundButton.addEventListener('click', startPlayback);
        reloadLink.addEventListener('click', (e) => {
            e.preventDefault();
            location.reload();
        });
        window.matchMedia("(orientation: portrait)").addEventListener("change", checkOrientation);

    </script>
</body>
</html>

</body>
</html>
